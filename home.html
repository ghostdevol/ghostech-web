<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Phantom – Flash ECU</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<nav>
    <a href="index.html">ECU</a>
    <a href="tune-select.html">Tunes</a>
    <a href="flash.html">Flash</a>
    <a href="gauges.html">Gauges</a>
    <a href="build-sheet.html">Build Sheet</a>
    <a href="engine-build.html">Engine Build</a>
</nav>

<main>
    <h1>Flash ECU</h1>

    <div class="card">
        <h3>Current Selection</h3>
        <p>Tune: <span id="flashTune">None selected</span></p>
        <p>ECU Status: <span id="flashEcuStatus">Disconnected</span></p>
        <button onclick="fakeConnect()">Connect ECU</button>
    </div>

    <div class="card">
        <h3>Flash Checklist</h3>
        <ul>
            <li>Battery charger connected</li>
            <li>No accessories on</li>
            <li>Stable connection to ECU</li>
        </ul>
        <button onclick="startFlash()" id="flashBtn" disabled>Begin Flash</button>
        <p id="flashStatus"></p>
        <div id="flashProgress" style="margin-top:10px;height:10px;background:#222;border-radius:5px;overflow:hidden;display:none;">
            <div id="flashBar" style="height:100%;width:0%;background:#0af;"></div>
        </div>
    </div>
</main>

<script src="js/main.js"></script>
<script>
    function refreshFlashTune() {
        const tune = localStorage.getItem("selectedTune") || "None selected";
        document.getElementById("flashTune").textContent = tune;
    }

    function fakeConnect() {
        document.getElementById("flashEcuStatus").textContent = "Connected";
        document.getElementById("flashBtn").disabled = false;
    }

    function startFlash() {
        const tune = localStorage.getItem("selectedTune");
        if (!tune) {
            alert("Select a tune first on the Tunes screen.");
            return;
        }

        const status = document.getElementById("flashStatus");
        const barWrap = document.getElementById("flashProgress");
        const bar = document.getElementById("flashBar");
        const btn = document.getElementById("flashBtn");

        btn.disabled = true;
        barWrap.style.display = "block";
        bar.style.width = "0%";
        status.textContent = "Flashing " + tune + "… do not disconnect.";

        let p = 0;
        const timer = setInterval(() => {
            p += 5;
            bar.style.width = p + "%";
            if (p >= 100) {
                clearInterval(timer);
                status.textContent = "Flash complete. Cycle ignition before starting.";
                btn.disabled = false;
            }
        }, 200);
    }

    refreshFlashTune();
</script>
</body>
</html>